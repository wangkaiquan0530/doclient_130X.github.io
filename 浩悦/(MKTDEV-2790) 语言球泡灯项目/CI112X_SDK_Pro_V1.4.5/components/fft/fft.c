#include "fft.h"
#include "ci112x_system.h"

#if 0
#define RET_SUCCESS 0
#define MASK_ROM_WINDOW_ADDR     (0x1F000000+79*1024)                                       // sin������
#define MASK_ROM_FFT_BIT_ADDR    (0x1F002000)                                       // 512fft�ı�1
#define MASK_ROM_FFT_COEF_R_ADDR (MASK_ROM_FFT_BIT_ADDR + sizeof(short)*440)       // 512fft�ı�2
#define MASK_ROM_FFT_COEF_ADDR   (MASK_ROM_FFT_COEF_R_ADDR + sizeof(float)*512)    // 512fft�ı�3
#define MASK_ROM_MEL_SCALE_ADDR  (MASK_ROM_FFT_COEF_ADDR + sizeof(float)*512)      // mel��Ҫ�ı�1
#define MASK_ROM_MEL_OFFSET_ADDR (MASK_ROM_MEL_SCALE_ADDR + sizeof(float)*512)     // mel��Ҫ�ı�2
#define MASK_ROM_ASR_WINDOW_ADDR (MASK_ROM_MEL_OFFSET_ADDR + sizeof(short)*(60))   // fe ��Ҫ�Ĵ�����
#define MASK_ROM_PCM_TABLE_ADDR  (MASK_ROM_ASR_WINDOW_ADDR + sizeof(short)*(400))  // ADPCM��Ҫ�õı�
#endif

const unsigned short riscvBitRevIndexTable256[RISCVBITREVINDEXTABLE_256_TABLE_LENGTH] =
{
   /* 8x4, size 440 */
   8,512, 16,1024, 24,1536, 32,64, 40,576, 48,1088, 56,1600, 64,128, 72,640,
   80,1152, 88,1664, 96,192, 104,704, 112,1216, 120,1728, 128,256, 136,768,
   144,1280, 152,1792, 160,320, 168,832, 176,1344, 184,1856, 192,384,
   200,896, 208,1408, 216,1920, 224,448, 232,960, 240,1472, 248,1984,
   256,512, 264,520, 272,1032, 280,1544, 288,640, 296,584, 304,1096, 312,1608,
   320,768, 328,648, 336,1160, 344,1672, 352,896, 360,712, 368,1224, 376,1736,
   384,520, 392,776, 400,1288, 408,1800, 416,648, 424,840, 432,1352, 440,1864,
   448,776, 456,904, 464,1416, 472,1928, 480,904, 488,968, 496,1480, 504,1992,
   520,528, 512,1024, 528,1040, 536,1552, 544,1152, 552,592, 560,1104,
   568,1616, 576,1280, 584,656, 592,1168, 600,1680, 608,1408, 616,720,
   624,1232, 632,1744, 640,1032, 648,784, 656,1296, 664,1808, 672,1160,
   680,848, 688,1360, 696,1872, 704,1288, 712,912, 720,1424, 728,1936,
   736,1416, 744,976, 752,1488, 760,2000, 768,1536, 776,1552, 784,1048,
   792,1560, 800,1664, 808,1680, 816,1112, 824,1624, 832,1792, 840,1808,
   848,1176, 856,1688, 864,1920, 872,1936, 880,1240, 888,1752, 896,1544,
   904,1560, 912,1304, 920,1816, 928,1672, 936,1688, 944,1368, 952,1880,
   960,1800, 968,1816, 976,1432, 984,1944, 992,1928, 1000,1944, 1008,1496,
   1016,2008, 1032,1152, 1040,1056, 1048,1568, 1064,1408, 1072,1120,
   1080,1632, 1088,1536, 1096,1160, 1104,1184, 1112,1696, 1120,1552,
   1128,1416, 1136,1248, 1144,1760, 1160,1664, 1168,1312, 1176,1824,
   1184,1544, 1192,1920, 1200,1376, 1208,1888, 1216,1568, 1224,1672,
   1232,1440, 1240,1952, 1248,1560, 1256,1928, 1264,1504, 1272,2016,
   1288,1312, 1296,1408, 1304,1576, 1320,1424, 1328,1416, 1336,1640,
   1344,1792, 1352,1824, 1360,1920, 1368,1704, 1376,1800, 1384,1432,
   1392,1928, 1400,1768, 1416,1680, 1432,1832, 1440,1576, 1448,1936,
   1456,1832, 1464,1896, 1472,1808, 1480,1688, 1488,1936, 1496,1960,
   1504,1816, 1512,1944, 1520,1944, 1528,2024, 1560,1584, 1592,1648,
   1600,1792, 1608,1920, 1616,1800, 1624,1712, 1632,1808, 1640,1936,
   1648,1816, 1656,1776, 1672,1696, 1688,1840, 1704,1952, 1712,1928,
   1720,1904, 1728,1824, 1736,1952, 1744,1832, 1752,1968, 1760,1840,
   1768,1960, 1776,1944, 1784,2032, 1864,1872, 1848,1944, 1872,1888,
   1880,1904, 1888,1984, 1896,2000, 1912,2032, 1904,2016, 1976,2032,
   1960,1968, 2008,2032, 1992,2016, 2024,2032
};

static const uint16_t riscvBitRevIndexTable512[RISCVBITREVINDEXTABLE_512_TABLE_LENGTH] =
{
   /* radix 8, size 448 */
   8,512, 16,1024, 24,1536, 32,2048, 40,2560, 48,3072, 56,3584, 72,576,
   80,1088, 88,1600, 96,2112, 104,2624, 112,3136, 120,3648, 136,640, 144,1152,
   152,1664, 160,2176, 168,2688, 176,3200, 184,3712, 200,704, 208,1216,
   216,1728, 224,2240, 232,2752, 240,3264, 248,3776, 264,768, 272,1280,
   280,1792, 288,2304, 296,2816, 304,3328, 312,3840, 328,832, 336,1344,
   344,1856, 352,2368, 360,2880, 368,3392, 376,3904, 392,896, 400,1408,
   408,1920, 416,2432, 424,2944, 432,3456, 440,3968, 456,960, 464,1472,
   472,1984, 480,2496, 488,3008, 496,3520, 504,4032, 528,1032, 536,1544,
   544,2056, 552,2568, 560,3080, 568,3592, 592,1096, 600,1608, 608,2120,
   616,2632, 624,3144, 632,3656, 656,1160, 664,1672, 672,2184, 680,2696,
   688,3208, 696,3720, 720,1224, 728,1736, 736,2248, 744,2760, 752,3272,
   760,3784, 784,1288, 792,1800, 800,2312, 808,2824, 816,3336, 824,3848,
   848,1352, 856,1864, 864,2376, 872,2888, 880,3400, 888,3912, 912,1416,
   920,1928, 928,2440, 936,2952, 944,3464, 952,3976, 976,1480, 984,1992,
   992,2504, 1000,3016, 1008,3528, 1016,4040, 1048,1552, 1056,2064, 1064,2576,
   1072,3088, 1080,3600, 1112,1616, 1120,2128, 1128,2640, 1136,3152,
   1144,3664, 1176,1680, 1184,2192, 1192,2704, 1200,3216, 1208,3728,
   1240,1744, 1248,2256, 1256,2768, 1264,3280, 1272,3792, 1304,1808,
   1312,2320, 1320,2832, 1328,3344, 1336,3856, 1368,1872, 1376,2384,
   1384,2896, 1392,3408, 1400,3920, 1432,1936, 1440,2448, 1448,2960,
   1456,3472, 1464,3984, 1496,2000, 1504,2512, 1512,3024, 1520,3536,
   1528,4048, 1568,2072, 1576,2584, 1584,3096, 1592,3608, 1632,2136,
   1640,2648, 1648,3160, 1656,3672, 1696,2200, 1704,2712, 1712,3224,
   1720,3736, 1760,2264, 1768,2776, 1776,3288, 1784,3800, 1824,2328,
   1832,2840, 1840,3352, 1848,3864, 1888,2392, 1896,2904, 1904,3416,
   1912,3928, 1952,2456, 1960,2968, 1968,3480, 1976,3992, 2016,2520,
   2024,3032, 2032,3544, 2040,4056, 2088,2592, 2096,3104, 2104,3616,
   2152,2656, 2160,3168, 2168,3680, 2216,2720, 2224,3232, 2232,3744,
   2280,2784, 2288,3296, 2296,3808, 2344,2848, 2352,3360, 2360,3872,
   2408,2912, 2416,3424, 2424,3936, 2472,2976, 2480,3488, 2488,4000,
   2536,3040, 2544,3552, 2552,4064, 2608,3112, 2616,3624, 2672,3176,
   2680,3688, 2736,3240, 2744,3752, 2800,3304, 2808,3816, 2864,3368,
   2872,3880, 2928,3432, 2936,3944, 2992,3496, 3000,4008, 3056,3560,
   3064,4072, 3128,3632, 3192,3696, 3256,3760, 3320,3824, 3384,3888,
   3448,3952, 3512,4016, 3576,4080
};


static const float twiddleCoef_256_2[512] = {
0.999924702f,0.012271538f,
0.999322385f,0.036807223f,
0.998118113f,0.061320736f,
0.996312612f,0.085797312f,
0.99390697f,0.110222207f,
0.990902635f,0.134580709f,
0.987301418f,0.158858143f,
0.983105487f,0.183039888f,
0.978317371f,0.207111376f,
0.972939952f,0.231058108f,
0.966976471f,0.25486566f,
0.960430519f,0.278519689f,
0.95330604f,0.302005949f,
0.945607325f,0.325310292f,
0.937339012f,0.34841868f,
0.92850608f,0.371317194f,
0.919113852f,0.39399204f,
0.909167983f,0.41642956f,
0.898674466f,0.438616239f,
0.88763962f,0.460538711f,
0.876070094f,0.482183772f,
0.863972856f,0.503538384f,
0.851355193f,0.524589683f,
0.838224706f,0.545324988f,
0.824589303f,0.565731811f,
0.810457198f,0.585797857f,
0.795836905f,0.605511041f,
0.780737229f,0.624859488f,
0.765167266f,0.643831543f,
0.749136395f,0.662415778f,
0.732654272f,0.680600998f,
0.715730825f,0.698376249f,
0.698376249f,0.715730825f,
0.680600998f,0.732654272f,
0.662415778f,0.749136395f,
0.643831543f,0.765167266f,
0.624859488f,0.780737229f,
0.605511041f,0.795836905f,
0.585797857f,0.810457198f,
0.565731811f,0.824589303f,
0.545324988f,0.838224706f,
0.524589683f,0.851355193f,
0.503538384f,0.863972856f,
0.482183772f,0.876070094f,
0.460538711f,0.88763962f,
0.438616239f,0.898674466f,
0.41642956f,0.909167983f,
0.39399204f,0.919113852f,
0.371317194f,0.92850608f,
0.34841868f,0.937339012f,
0.325310292f,0.945607325f,
0.302005949f,0.95330604f,
0.278519689f,0.960430519f,
0.25486566f,0.966976471f,
0.231058108f,0.972939952f,
0.207111376f,0.978317371f,
0.183039888f,0.983105487f,
0.158858143f,0.987301418f,
0.134580709f,0.990902635f,
0.110222207f,0.99390697f,
0.085797312f,0.996312612f,
0.061320736f,0.998118113f,
0.036807223f,0.999322385f,
0.012271538f,0.999924702f,
-0.012271538f,0.999924702f,
-0.036807223f,0.999322385f,
-0.061320736f,0.998118113f,
-0.085797312f,0.996312612f,
-0.110222207f,0.99390697f,
-0.134580709f,0.990902635f,
-0.158858143f,0.987301418f,
-0.183039888f,0.983105487f,
-0.207111376f,0.978317371f,
-0.231058108f,0.972939952f,
-0.25486566f,0.966976471f,
-0.278519689f,0.960430519f,
-0.302005949f,0.95330604f,
-0.325310292f,0.945607325f,
-0.34841868f,0.937339012f,
-0.371317194f,0.92850608f,
-0.39399204f,0.919113852f,
-0.41642956f,0.909167983f,
-0.438616239f,0.898674466f,
-0.460538711f,0.88763962f,
-0.482183772f,0.876070094f,
-0.503538384f,0.863972856f,
-0.524589683f,0.851355193f,
-0.545324988f,0.838224706f,
-0.565731811f,0.824589303f,
-0.585797857f,0.810457198f,
-0.605511041f,0.795836905f,
-0.624859488f,0.780737229f,
-0.643831543f,0.765167266f,
-0.662415778f,0.749136395f,
-0.680600998f,0.732654272f,
-0.698376249f,0.715730825f,
-0.715730825f,0.698376249f,
-0.732654272f,0.680600998f,
-0.749136395f,0.662415778f,
-0.765167266f,0.643831543f,
-0.780737229f,0.624859488f,
-0.795836905f,0.605511041f,
-0.810457198f,0.585797857f,
-0.824589303f,0.565731811f,
-0.838224706f,0.545324988f,
-0.851355193f,0.524589683f,
-0.863972856f,0.503538384f,
-0.876070094f,0.482183772f,
-0.88763962f,0.460538711f,
-0.898674466f,0.438616239f,
-0.909167983f,0.41642956f,
-0.919113852f,0.39399204f,
-0.92850608f,0.371317194f,
-0.937339012f,0.34841868f,
-0.945607325f,0.325310292f,
-0.95330604f,0.302005949f,
-0.960430519f,0.278519689f,
-0.966976471f,0.25486566f,
-0.972939952f,0.231058108f,
-0.978317371f,0.207111376f,
-0.983105487f,0.183039888f,
-0.987301418f,0.158858143f,
-0.990902635f,0.134580709f,
-0.99390697f,0.110222207f,
-0.996312612f,0.085797312f,
-0.998118113f,0.061320736f,
-0.999322385f,0.036807223f,
-0.999924702f,0.012271538f,
-0.999924702f,-0.012271538f,
-0.999322385f,-0.036807223f,
-0.998118113f,-0.061320736f,
-0.996312612f,-0.085797312f,
-0.99390697f,-0.110222207f,
-0.990902635f,-0.134580709f,
-0.987301418f,-0.158858143f,
-0.983105487f,-0.183039888f,
-0.978317371f,-0.207111376f,
-0.972939952f,-0.231058108f,
-0.966976471f,-0.25486566f,
-0.960430519f,-0.278519689f,
-0.95330604f,-0.302005949f,
-0.945607325f,-0.325310292f,
-0.937339012f,-0.34841868f,
-0.92850608f,-0.371317194f,
-0.919113852f,-0.39399204f,
-0.909167983f,-0.41642956f,
-0.898674466f,-0.438616239f,
-0.88763962f,-0.460538711f,
-0.876070094f,-0.482183772f,
-0.863972856f,-0.503538384f,
-0.851355193f,-0.524589683f,
-0.838224706f,-0.545324988f,
-0.824589303f,-0.565731811f,
-0.810457198f,-0.585797857f,
-0.795836905f,-0.605511041f,
-0.780737229f,-0.624859488f,
-0.765167266f,-0.643831543f,
-0.749136395f,-0.662415778f,
-0.732654272f,-0.680600998f,
-0.715730825f,-0.698376249f,
-0.698376249f,-0.715730825f,
-0.680600998f,-0.732654272f,
-0.662415778f,-0.749136395f,
-0.643831543f,-0.765167266f,
-0.624859488f,-0.780737229f,
-0.605511041f,-0.795836905f,
-0.585797857f,-0.810457198f,
-0.565731811f,-0.824589303f,
-0.545324988f,-0.838224706f,
-0.524589683f,-0.851355193f,
-0.503538384f,-0.863972856f,
-0.482183772f,-0.876070094f,
-0.460538711f,-0.88763962f,
-0.438616239f,-0.898674466f,
-0.41642956f,-0.909167983f,
-0.39399204f,-0.919113852f,
-0.371317194f,-0.92850608f,
-0.34841868f,-0.937339012f,
-0.325310292f,-0.945607325f,
-0.302005949f,-0.95330604f,
-0.278519689f,-0.960430519f,
-0.25486566f,-0.966976471f,
-0.231058108f,-0.972939952f,
-0.207111376f,-0.978317371f,
-0.183039888f,-0.983105487f,
-0.158858143f,-0.987301418f,
-0.134580709f,-0.990902635f,
-0.110222207f,-0.99390697f,
-0.085797312f,-0.996312612f,
-0.061320736f,-0.998118113f,
-0.036807223f,-0.999322385f,
-0.012271538f,-0.999924702f,
0.012271538f,-0.999924702f,
0.036807223f,-0.999322385f,
0.061320736f,-0.998118113f,
0.085797312f,-0.996312612f,
0.110222207f,-0.99390697f,
0.134580709f,-0.990902635f,
0.158858143f,-0.987301418f,
0.183039888f,-0.983105487f,
0.207111376f,-0.978317371f,
0.231058108f,-0.972939952f,
0.25486566f,-0.966976471f,
0.278519689f,-0.960430519f,
0.302005949f,-0.95330604f,
0.325310292f,-0.945607325f,
0.34841868f,-0.937339012f,
0.371317194f,-0.92850608f,
0.39399204f,-0.919113852f,
0.41642956f,-0.909167983f,
0.438616239f,-0.898674466f,
0.460538711f,-0.88763962f,
0.482183772f,-0.876070094f,
0.503538384f,-0.863972856f,
0.524589683f,-0.851355193f,
0.545324988f,-0.838224706f,
0.565731811f,-0.824589303f,
0.585797857f,-0.810457198f,
0.605511041f,-0.795836905f,
0.624859488f,-0.780737229f,
0.643831543f,-0.765167266f,
0.662415778f,-0.749136395f,
0.680600998f,-0.732654272f,
0.698376249f,-0.715730825f,
0.715730825f,-0.698376249f,
0.732654272f,-0.680600998f,
0.749136395f,-0.662415778f,
0.765167266f,-0.643831543f,
0.780737229f,-0.624859488f,
0.795836905f,-0.605511041f,
0.810457198f,-0.585797857f,
0.824589303f,-0.565731811f,
0.838224706f,-0.545324988f,
0.851355193f,-0.524589683f,
0.863972856f,-0.503538384f,
0.876070094f,-0.482183772f,
0.88763962f,-0.460538711f,
0.898674466f,-0.438616239f,
0.909167983f,-0.41642956f,
0.919113852f,-0.39399204f,
0.92850608f,-0.371317194f,
0.937339012f,-0.34841868f,
0.945607325f,-0.325310292f,
0.95330604f,-0.302005949f,
0.960430519f,-0.278519689f,
0.966976471f,-0.25486566f,
0.972939952f,-0.231058108f,
0.978317371f,-0.207111376f,
0.983105487f,-0.183039888f,
0.987301418f,-0.158858143f,
0.990902635f,-0.134580709f,
0.99390697f,-0.110222207f,
0.996312612f,-0.085797312f,
0.998118113f,-0.061320736f,
0.999322385f,-0.036807223f,
0.999924702f,-0.012271538f,

};

static const float twiddleCoef_rfft_512_2[512] = {
0.006135885f,0.999981175f,
0.01840673f,0.999830582f,
0.030674803f,0.999529418f,
0.042938257f,0.999077728f,
0.055195244f,0.998475581f,
0.06744392f,0.997723067f,
0.079682438f,0.996820299f,
0.091908956f,0.995767414f,
0.104121634f,0.994564571f,
0.116318631f,0.993211949f,
0.128498111f,0.991709754f,
0.140658239f,0.99005821f,
0.152797185f,0.988257568f,
0.16491312f,0.986308097f,
0.17700422f,0.984210092f,
0.189068664f,0.981963869f,
0.201104635f,0.979569766f,
0.21311032f,0.977028143f,
0.225083911f,0.974339383f,
0.237023606f,0.971503891f,
0.248927606f,0.968522094f,
0.260794118f,0.965394442f,
0.272621355f,0.962121404f,
0.284407537f,0.958703475f,
0.296150888f,0.955141168f,
0.30784964f,0.951435021f,
0.319502031f,0.947585591f,
0.331106306f,0.943593458f,
0.342660717f,0.939459224f,
0.354163525f,0.93518351f,
0.365612998f,0.930766961f,
0.37700741f,0.926210242f,
0.388345047f,0.921514039f,
0.3996242f,0.91667906f,
0.410843171f,0.911706032f,
0.422000271f,0.906595705f,
0.433093819f,0.901348847f,
0.444122145f,0.89596625f,
0.455083587f,0.890448723f,
0.465976496f,0.884797098f,
0.47679923f,0.879012226f,
0.48755016f,0.873094978f,
0.498227667f,0.867046246f,
0.508830143f,0.860866939f,
0.51935599f,0.854557988f,
0.529803625f,0.848120345f,
0.540171473f,0.841554977f,
0.550457973f,0.834862875f,
0.560661576f,0.828045045f,
0.570780746f,0.821102515f,
0.580813958f,0.81403633f,
0.590759702f,0.806847554f,
0.600616479f,0.799537269f,
0.610382806f,0.792106577f,
0.620057212f,0.784556597f,
0.629638239f,0.776888466f,
0.639124445f,0.769103338f,
0.648514401f,0.761202385f,
0.657806693f,0.753186799f,
0.666999922f,0.745057785f,
0.676092704f,0.736816569f,
0.685083668f,0.72846439f,
0.693971461f,0.720002508f,
0.702754744f,0.711432196f,
0.711432196f,0.702754744f,
0.720002508f,0.693971461f,
0.72846439f,0.685083668f,
0.736816569f,0.676092704f,
0.745057785f,0.666999922f,
0.753186799f,0.657806693f,
0.761202385f,0.648514401f,
0.769103338f,0.639124445f,
0.776888466f,0.629638239f,
0.784556597f,0.620057212f,
0.792106577f,0.610382806f,
0.799537269f,0.600616479f,
0.806847554f,0.590759702f,
0.81403633f,0.580813958f,
0.821102515f,0.570780746f,
0.828045045f,0.560661576f,
0.834862875f,0.550457973f,
0.841554977f,0.540171473f,
0.848120345f,0.529803625f,
0.854557988f,0.51935599f,
0.860866939f,0.508830143f,
0.867046246f,0.498227667f,
0.873094978f,0.48755016f,
0.879012226f,0.47679923f,
0.884797098f,0.465976496f,
0.890448723f,0.455083587f,
0.89596625f,0.444122145f,
0.901348847f,0.433093819f,
0.906595705f,0.422000271f,
0.911706032f,0.410843171f,
0.91667906f,0.3996242f,
0.921514039f,0.388345047f,
0.926210242f,0.37700741f,
0.930766961f,0.365612998f,
0.93518351f,0.354163525f,
0.939459224f,0.342660717f,
0.943593458f,0.331106306f,
0.947585591f,0.319502031f,
0.951435021f,0.30784964f,
0.955141168f,0.296150888f,
0.958703475f,0.284407537f,
0.962121404f,0.272621355f,
0.965394442f,0.260794118f,
0.968522094f,0.248927606f,
0.971503891f,0.237023606f,
0.974339383f,0.225083911f,
0.977028143f,0.21311032f,
0.979569766f,0.201104635f,
0.981963869f,0.189068664f,
0.984210092f,0.17700422f,
0.986308097f,0.16491312f,
0.988257568f,0.152797185f,
0.99005821f,0.140658239f,
0.991709754f,0.128498111f,
0.993211949f,0.116318631f,
0.994564571f,0.104121634f,
0.995767414f,0.091908956f,
0.996820299f,0.079682438f,
0.997723067f,0.06744392f,
0.998475581f,0.055195244f,
0.999077728f,0.042938257f,
0.999529418f,0.030674803f,
0.999830582f,0.01840673f,
0.999981175f,0.006135885f,
0.999981175f,-0.006135885f,
0.999830582f,-0.01840673f,
0.999529418f,-0.030674803f,
0.999077728f,-0.042938257f,
0.998475581f,-0.055195244f,
0.997723067f,-0.06744392f,
0.996820299f,-0.079682438f,
0.995767414f,-0.091908956f,
0.994564571f,-0.104121634f,
0.993211949f,-0.116318631f,
0.991709754f,-0.128498111f,
0.99005821f,-0.140658239f,
0.988257568f,-0.152797185f,
0.986308097f,-0.16491312f,
0.984210092f,-0.17700422f,
0.981963869f,-0.189068664f,
0.979569766f,-0.201104635f,
0.977028143f,-0.21311032f,
0.974339383f,-0.225083911f,
0.971503891f,-0.237023606f,
0.968522094f,-0.248927606f,
0.965394442f,-0.260794118f,
0.962121404f,-0.272621355f,
0.958703475f,-0.284407537f,
0.955141168f,-0.296150888f,
0.951435021f,-0.30784964f,
0.947585591f,-0.319502031f,
0.943593458f,-0.331106306f,
0.939459224f,-0.342660717f,
0.93518351f,-0.354163525f,
0.930766961f,-0.365612998f,
0.926210242f,-0.37700741f,
0.921514039f,-0.388345047f,
0.91667906f,-0.3996242f,
0.911706032f,-0.410843171f,
0.906595705f,-0.422000271f,
0.901348847f,-0.433093819f,
0.89596625f,-0.444122145f,
0.890448723f,-0.455083587f,
0.884797098f,-0.465976496f,
0.879012226f,-0.47679923f,
0.873094978f,-0.48755016f,
0.867046246f,-0.498227667f,
0.860866939f,-0.508830143f,
0.854557988f,-0.51935599f,
0.848120345f,-0.529803625f,
0.841554977f,-0.540171473f,
0.834862875f,-0.550457973f,
0.828045045f,-0.560661576f,
0.821102515f,-0.570780746f,
0.81403633f,-0.580813958f,
0.806847554f,-0.590759702f,
0.799537269f,-0.600616479f,
0.792106577f,-0.610382806f,
0.784556597f,-0.620057212f,
0.776888466f,-0.629638239f,
0.769103338f,-0.639124445f,
0.761202385f,-0.648514401f,
0.753186799f,-0.657806693f,
0.745057785f,-0.666999922f,
0.736816569f,-0.676092704f,
0.72846439f,-0.685083668f,
0.720002508f,-0.693971461f,
0.711432196f,-0.702754744f,
0.702754744f,-0.711432196f,
0.693971461f,-0.720002508f,
0.685083668f,-0.72846439f,
0.676092704f,-0.736816569f,
0.666999922f,-0.745057785f,
0.657806693f,-0.753186799f,
0.648514401f,-0.761202385f,
0.639124445f,-0.769103338f,
0.629638239f,-0.776888466f,
0.620057212f,-0.784556597f,
0.610382806f,-0.792106577f,
0.600616479f,-0.799537269f,
0.590759702f,-0.806847554f,
0.580813958f,-0.81403633f,
0.570780746f,-0.821102515f,
0.560661576f,-0.828045045f,
0.550457973f,-0.834862875f,
0.540171473f,-0.841554977f,
0.529803625f,-0.848120345f,
0.51935599f,-0.854557988f,
0.508830143f,-0.860866939f,
0.498227667f,-0.867046246f,
0.48755016f,-0.873094978f,
0.47679923f,-0.879012226f,
0.465976496f,-0.884797098f,
0.455083587f,-0.890448723f,
0.444122145f,-0.89596625f,
0.433093819f,-0.901348847f,
0.422000271f,-0.906595705f,
0.410843171f,-0.911706032f,
0.3996242f,-0.91667906f,
0.388345047f,-0.921514039f,
0.37700741f,-0.926210242f,
0.365612998f,-0.930766961f,
0.354163525f,-0.93518351f,
0.342660717f,-0.939459224f,
0.331106306f,-0.943593458f,
0.319502031f,-0.947585591f,
0.30784964f,-0.951435021f,
0.296150888f,-0.955141168f,
0.284407537f,-0.958703475f,
0.272621355f,-0.962121404f,
0.260794118f,-0.965394442f,
0.248927606f,-0.968522094f,
0.237023606f,-0.971503891f,
0.225083911f,-0.974339383f,
0.21311032f,-0.977028143f,
0.201104635f,-0.979569766f,
0.189068664f,-0.981963869f,
0.17700422f,-0.984210092f,
0.16491312f,-0.986308097f,
0.152797185f,-0.988257568f,
0.140658239f,-0.99005821f,
0.128498111f,-0.991709754f,
0.116318631f,-0.993211949f,
0.104121634f,-0.994564571f,
0.091908956f,-0.995767414f,
0.079682438f,-0.996820299f,
0.06744392f,-0.997723067f,
0.055195244f,-0.998475581f,
0.042938257f,-0.999077728f,
0.030674803f,-0.999529418f,
0.01840673f,-0.999830582f,
0.006135885f,-0.999981175f,
};

/* Prepares data for inverse cfft */
void merge_rfft_f32(
  const riscv_rfft_fast_instance_f32 * S,
        float * p,
        float * pOut)
{
        uint32_t  k;                                /* Loop Counter */
        float twR, twI;                         /* RFFT Twiddle coefficients */
  const float *pCoeff = S->pTwiddleRFFT;        /* Points to RFFT Twiddle factors */
        float *pA = p;                          /* increasing pointer */
        float *pB = p;                          /* decreasing pointer */
        float xAR, xAI, xBR, xBI;               /* temporary variables */
        float t1a, t1b, r, s, t, u;             /* temporary variables */



   k = (S->Sint).fftLen - 1;

   const float * pCoeff_ptr[2] = {0};
   pCoeff_ptr[0] = pCoeff;
   int idx = 0;
   int flag_1024 = 0;
   if(1024U == S->fftLenRFFT )
   {
	 pCoeff_ptr[1] = S->pTwiddleRFFT2;
	 flag_1024 = 1;
	 idx = 1;
   }

   xAR = pA[0];
   xAI = pA[1];

   (pCoeff_ptr[0]++);
   (pCoeff_ptr[0]++);

   *pOut++ = 0.5f * ( xAR + xAI );
   *pOut++ = 0.5f * ( xAR - xAI );

   pB  =  p + 2*k ;
   pA +=  2	   ;

   
   
   while (k > 0U)
   {
      /* G is half of the frequency complex spectrum */
      xBI =   pB[1]    ;
      xBR =   pB[0]    ;
      xAR =  pA[0];
      xAI =  pA[1];

      twR = *pCoeff++;
      twI = *pCoeff++;

	  twR = *(pCoeff_ptr[idx])++;
      twI = *(pCoeff_ptr[idx])++;

	  idx = flag_1024 && !idx;  


      t1a = xAR - xBR ;
      t1b = xAI + xBI ;

      r = twR * t1a;
      s = twI * t1b;
      t = twI * t1a;
      u = twR * t1b;

      *pOut++ = 0.5f * (xAR + xBR - r - s ); 
      *pOut++ = 0.5f * (xAI - xBI + t - u ); 

      pA += 2;
      pB -= 2;
      k--;
   }

}

static void riscv_radix8_butterfly_f32(
  float * pSrc,
  unsigned short fftLen,
  const float * pCoef,
  const float * pCoef2,
  unsigned short twidCoefModifier)
{
   uint32_t ia1, ia2, ia3, ia4, ia5, ia6, ia7;
   uint32_t i1, i2, i3, i4, i5, i6, i7, i8;
   uint32_t id;
   uint32_t n1, n2, j;

   float r1, r2, r3, r4, r5, r6, r7, r8;
   float t1, t2;
   float s1, s2, s3, s4, s5, s6, s7, s8;
   float p1, p2, p3, p4;
   float co2, co3, co4, co5, co6, co7, co8;
   float si2, si3, si4, si5, si6, si7, si8;
   const float C81 = 0.70710678118f;

   const float * pCoef_ptr[2] = {0};
   int scale = 2;//fft 1024 �� 512��ȡֵ�漰����
   short idx1,idx2,idx3,idx4,idx5,idx6,idx7;
   pCoef_ptr[0] = pCoef;
   if(128 == fftLen || 512 == fftLen)
   {       
       pCoef_ptr[1] = pCoef2;
	   scale = 1;
   }

   
   n2 = fftLen;

   do
   {
      n1 = n2;
      n2 = n2 >> 3;
      i1 = 0;

      do
      {
         i2 = i1 + n2;
         i3 = i2 + n2;
         i4 = i3 + n2;
         i5 = i4 + n2;
         i6 = i5 + n2;
         i7 = i6 + n2;
         i8 = i7 + n2;
         r1 = pSrc[2 * i1] + pSrc[2 * i5];
         r5 = pSrc[2 * i1] - pSrc[2 * i5];
         r2 = pSrc[2 * i2] + pSrc[2 * i6];
         r6 = pSrc[2 * i2] - pSrc[2 * i6];
         r3 = pSrc[2 * i3] + pSrc[2 * i7];
         r7 = pSrc[2 * i3] - pSrc[2 * i7];
         r4 = pSrc[2 * i4] + pSrc[2 * i8];
         r8 = pSrc[2 * i4] - pSrc[2 * i8];
         t1 = r1 - r3;
         r1 = r1 + r3;
         r3 = r2 - r4;
         r2 = r2 + r4;
         pSrc[2 * i1] = r1 + r2;
         pSrc[2 * i5] = r1 - r2;
         r1 = pSrc[2 * i1 + 1] + pSrc[2 * i5 + 1];
         s5 = pSrc[2 * i1 + 1] - pSrc[2 * i5 + 1];
         r2 = pSrc[2 * i2 + 1] + pSrc[2 * i6 + 1];
         s6 = pSrc[2 * i2 + 1] - pSrc[2 * i6 + 1];
         s3 = pSrc[2 * i3 + 1] + pSrc[2 * i7 + 1];
         s7 = pSrc[2 * i3 + 1] - pSrc[2 * i7 + 1];
         r4 = pSrc[2 * i4 + 1] + pSrc[2 * i8 + 1];
         s8 = pSrc[2 * i4 + 1] - pSrc[2 * i8 + 1];
         t2 = r1 - s3;
         r1 = r1 + s3;
         s3 = r2 - r4;
         r2 = r2 + r4;
         pSrc[2 * i1 + 1] = r1 + r2;
         pSrc[2 * i5 + 1] = r1 - r2;
         pSrc[2 * i3]     = t1 + s3;
         pSrc[2 * i7]     = t1 - s3;
         pSrc[2 * i3 + 1] = t2 - r3;
         pSrc[2 * i7 + 1] = t2 + r3;
         r1 = (r6 - r8) * C81;
         r6 = (r6 + r8) * C81;
         r2 = (s6 - s8) * C81;
         s6 = (s6 + s8) * C81;
         t1 = r5 - r1;
         r5 = r5 + r1;
         r8 = r7 - r6;
         r7 = r7 + r6;
         t2 = s5 - r2;
         s5 = s5 + r2;
         s8 = s7 - s6;
         s7 = s7 + s6;
         pSrc[2 * i2]     = r5 + s7;
         pSrc[2 * i8]     = r5 - s7;
         pSrc[2 * i6]     = t1 + s8;
         pSrc[2 * i4]     = t1 - s8;
         pSrc[2 * i2 + 1] = s5 - r7;
         pSrc[2 * i8 + 1] = s5 + r7;
         pSrc[2 * i6 + 1] = t2 - r8;
         pSrc[2 * i4 + 1] = t2 + r8;

         i1 += n1;
      } while (i1 < fftLen);

      if (n2 < 8)
         break;

      ia1 = 0;
      j = 1;

      do
      {
         /*  index calculation for the coefficients */
         id  = ia1 + twidCoefModifier;
         ia1 = id;
         ia2 = ia1 + id;
         ia3 = ia2 + id;
         ia4 = ia3 + id;
         ia5 = ia4 + id;
         ia6 = ia5 + id;
         ia7 = ia6 + id;


		 idx1 = 	(ia1 & 0x1);
		 idx2 = 	(ia2 & 0x1);
		 idx3 = 	(ia3 & 0x1);
		 idx4 = 	(ia4 & 0x1);
		 idx5 = 	(ia5 & 0x1);
		 idx6 = 	(ia6 & 0x1);
	   	 idx7 = 	(ia7 & 0x1);

		 
		 co2 = pCoef_ptr[idx1][scale*(ia1 - idx1)];
		 co3 = pCoef_ptr[idx2][scale*(ia2 - idx2)];
		 co4 = pCoef_ptr[idx3][scale*(ia3- idx3) ];
		 co5 = pCoef_ptr[idx4][scale*(ia4 - idx4)];
		 co6 = pCoef_ptr[idx5][scale*(ia5- idx5) ];
		 co7 = pCoef_ptr[idx6][scale*(ia6- idx6) ];
		 co8 = pCoef_ptr[idx7][scale*(ia7- idx7) ];
		 si2 = pCoef_ptr[idx1][scale*(ia1 - idx1) + 1 ];
		 si3 = pCoef_ptr[idx2][scale*(ia2 - idx2) + 1 ];
		 si4 = pCoef_ptr[idx3][scale*(ia3 - idx3) + 1 ];
		 si5 = pCoef_ptr[idx4][scale*(ia4 - idx4) + 1 ];
	 	 si6 = pCoef_ptr[idx5][scale*(ia5 - idx5) + 1 ];
		 si7 = pCoef_ptr[idx6][scale*(ia6 - idx6) + 1 ];
		 si8 = pCoef_ptr[idx7][scale*(ia7 - idx7) + 1 ];

         i1 = j;

         do
         {
            /*  index calculation for the input */
            i2 = i1 + n2;
            i3 = i2 + n2;
            i4 = i3 + n2;
            i5 = i4 + n2;
            i6 = i5 + n2;
            i7 = i6 + n2;
            i8 = i7 + n2;
            r1 = pSrc[2 * i1] + pSrc[2 * i5];
            r5 = pSrc[2 * i1] - pSrc[2 * i5];
            r2 = pSrc[2 * i2] + pSrc[2 * i6];
            r6 = pSrc[2 * i2] - pSrc[2 * i6];
            r3 = pSrc[2 * i3] + pSrc[2 * i7];
            r7 = pSrc[2 * i3] - pSrc[2 * i7];
            r4 = pSrc[2 * i4] + pSrc[2 * i8];
            r8 = pSrc[2 * i4] - pSrc[2 * i8];
            t1 = r1 - r3;
            r1 = r1 + r3;
            r3 = r2 - r4;
            r2 = r2 + r4;
            pSrc[2 * i1] = r1 + r2;
            r2 = r1 - r2;
            s1 = pSrc[2 * i1 + 1] + pSrc[2 * i5 + 1];
            s5 = pSrc[2 * i1 + 1] - pSrc[2 * i5 + 1];
            s2 = pSrc[2 * i2 + 1] + pSrc[2 * i6 + 1];
            s6 = pSrc[2 * i2 + 1] - pSrc[2 * i6 + 1];
            s3 = pSrc[2 * i3 + 1] + pSrc[2 * i7 + 1];
            s7 = pSrc[2 * i3 + 1] - pSrc[2 * i7 + 1];
            s4 = pSrc[2 * i4 + 1] + pSrc[2 * i8 + 1];
            s8 = pSrc[2 * i4 + 1] - pSrc[2 * i8 + 1];
            t2 = s1 - s3;
            s1 = s1 + s3;
            s3 = s2 - s4;
            s2 = s2 + s4;
            r1 = t1 + s3;
            t1 = t1 - s3;
            pSrc[2 * i1 + 1] = s1 + s2;
            s2 = s1 - s2;
            s1 = t2 - r3;
            t2 = t2 + r3;
            p1 = co5 * r2;
            p2 = si5 * s2;
            p3 = co5 * s2;
            p4 = si5 * r2;
            pSrc[2 * i5]     = p1 + p2;
            pSrc[2 * i5 + 1] = p3 - p4;
            p1 = co3 * r1;
            p2 = si3 * s1;
            p3 = co3 * s1;
            p4 = si3 * r1;
            pSrc[2 * i3]     = p1 + p2;
            pSrc[2 * i3 + 1] = p3 - p4;
            p1 = co7 * t1;
            p2 = si7 * t2;
            p3 = co7 * t2;
            p4 = si7 * t1;
            pSrc[2 * i7]     = p1 + p2;
            pSrc[2 * i7 + 1] = p3 - p4;
            r1 = (r6 - r8) * C81;
            r6 = (r6 + r8) * C81;
            s1 = (s6 - s8) * C81;
            s6 = (s6 + s8) * C81;
            t1 = r5 - r1;
            r5 = r5 + r1;
            r8 = r7 - r6;
            r7 = r7 + r6;
            t2 = s5 - s1;
            s5 = s5 + s1;
            s8 = s7 - s6;
            s7 = s7 + s6;
            r1 = r5 + s7;
            r5 = r5 - s7;
            r6 = t1 + s8;
            t1 = t1 - s8;
            s1 = s5 - r7;
            s5 = s5 + r7;
            s6 = t2 - r8;
            t2 = t2 + r8;
            p1 = co2 * r1;
            p2 = si2 * s1;
            p3 = co2 * s1;
            p4 = si2 * r1;
            pSrc[2 * i2]     = p1 + p2;
            pSrc[2 * i2 + 1] = p3 - p4;
            p1 = co8 * r5;
            p2 = si8 * s5;
            p3 = co8 * s5;
            p4 = si8 * r5;
            pSrc[2 * i8]     = p1 + p2;
            pSrc[2 * i8 + 1] = p3 - p4;
            p1 = co6 * r6;
            p2 = si6 * s6;
            p3 = co6 * s6;
            p4 = si6 * r6;
            pSrc[2 * i6]     = p1 + p2;
            pSrc[2 * i6 + 1] = p3 - p4;
            p1 = co4 * t1;
            p2 = si4 * t2;
            p3 = co4 * t2;
            p4 = si4 * t1;
            pSrc[2 * i4]     = p1 + p2;
            pSrc[2 * i4 + 1] = p3 - p4;

            i1 += n1;
         } while (i1 < fftLen);

         j++;
      } while (j < n2);

      twidCoefModifier <<= 3;
   } while (n2 > 7);
}

static void stage_rfft_f32(
  const riscv_rfft_fast_instance_f32 * S,
        float * p,
        float * pOut)
{
        uint32_t  k;                                /* Loop Counter */
        float twR, twI;                         /* RFFT Twiddle coefficients */
  const float * pCoeff = S->pTwiddleRFFT;       /* Points to RFFT Twiddle factors */
        float *pA = p;                          /* increasing pointer */
        float *pB = p;                          /* decreasing pointer */
        float xAR, xAI, xBR, xBI;               /* temporary variables */
        float t1a, t1b;                         /* temporary variables */
        float p0, p1, p2, p3;                   /* temporary variables */
  const float *pCoeff_ptr[2] = {0};
   
   pCoeff_ptr[0] = pCoeff;
   int idx = 0;
   int flag_1024 = 0;
   if(S->fftLenRFFT == 1024U)
   {
		pCoeff_ptr[1] = S->pTwiddleRFFT2;
		flag_1024 = 1;
		idx = 1;	
   }
   
   k = (S->Sint).fftLen - 1;

   /* Pack first and last sample of the frequency domain together */

   xBR = pB[0];
   xBI = pB[1];
   xAR = pA[0];
   xAI = pA[1];

   twR = *(pCoeff_ptr[0])++ ;
   twI = *(pCoeff_ptr[0])++ ;

   t1a = xBR + xAR  ;

   t1b = xBI + xAI  ;

   *pOut++ = 0.5f * ( t1a + t1b );
   *pOut++ = 0.5f * ( t1a - t1b );

   pB  = p + 2*k;
   pA += 2;

   
   
   do
   {
      /*
         function X = my_split_rfft(X, ifftFlag)
         % X is a series of real numbers
         L  = length(X);
         XC = X(1:2:end) +i*X(2:2:end);
         XA = fft(XC);
         XB = conj(XA([1 end:-1:2]));
         TW = i*exp(-2*pi*i*[0:L/2-1]/L).';
         for l = 2:L/2
            XA(l) = 1/2 * (XA(l) + XB(l) + TW(l) * (XB(l) - XA(l)));
         end
         XA(1) = 1/2* (XA(1) + XB(1) + TW(1) * (XB(1) - XA(1))) + i*( 1/2*( XA(1) + XB(1) + i*( XA(1) - XB(1))));
         X = XA;
      */

      xBI = pB[1];
      xBR = pB[0];
      xAR = pA[0];
      xAI = pA[1];

      //twR = *pCoeff++;
      //twI = *pCoeff++;

      twR = *(pCoeff_ptr[idx])++;
      twI = *(pCoeff_ptr[idx])++;

	  idx =  flag_1024 && !idx;

      t1a = xBR - xAR ;
      t1b = xBI + xAI ;

      p0 = twR * t1a;
      p1 = twI * t1a;
      p2 = twR * t1b;
      p3 = twI * t1b;

      *pOut++ = 0.5f * (xAR + xBR + p0 + p3 ); //xAR
      *pOut++ = 0.5f * (xAI - xBI + p1 - p2 ); //xAI

      pA += 2;
      pB -= 2;
      k--;
   } while (k > 0U);
}


static void riscv_bitreversal_32(
        uint32_t *pSrc, 
  const unsigned short bitRevLen, 
  const unsigned short *pBitRevTab)
{
  uint32_t a, b, i, tmp;

  for (i = 0; i < bitRevLen; )
  {
     a = pBitRevTab[i    ] >> 2;
     b = pBitRevTab[i + 1] >> 2;

     //real
     tmp = pSrc[a];
     pSrc[a] = pSrc[b];
     pSrc[b] = tmp;

     //complex
     tmp = pSrc[a+1];
     pSrc[a+1] = pSrc[b+1];
     pSrc[b+1] = tmp;

    i += 2;
  }
}

static void riscv_cfft_radix8by4_f32 (riscv_cfft_instance_f32 * S, float * p1)
{
    uint32_t    L  = S->fftLen >> 1;
    float * pCol1, *pCol2, *pCol3, *pCol4, *pEnd1, *pEnd2, *pEnd3, *pEnd4;
    const float *tw2, *tw3, *tw4;
    float * p2 = p1 + L;
    float * p3 = p2 + L;
    float * p4 = p3 + L;
    float t2[4], t3[4], t4[4], twR, twI;
    float p1ap3_0, p1sp3_0, p1ap3_1, p1sp3_1;
    float m0, m1, m2, m3;
    uint32_t l, twMod2, twMod3, twMod4;
	uint32_t twMod2_2, twMod3_2, twMod4_2;
	const float * tw2_ptr[2] = {0};
	const float * tw3_ptr[2] = {0};
	const float * tw4_ptr[2] = {0};
	tw4_ptr[0] = tw3_ptr[0] = tw2_ptr[0] = S->pTwiddle;
	tw4_ptr[1] = tw3_ptr[1] = tw2_ptr[1] = S->pTwiddle2;
	int idx2 = 0,idx3 = 0, idx4 = 0;
    pCol1 = p1;         /* points to real values by default */
    pCol2 = p2;
    pCol3 = p3;
    pCol4 = p4;
    pEnd1 = p2 - 1;     /* points to imaginary values by default */
    pEnd2 = p3 - 1;
    pEnd3 = p4 - 1;
    pEnd4 = pEnd3 + L;

    tw2 = tw3 = tw4 = (float *) S->pTwiddle;

    L >>= 1;

    /* do four dot Fourier transform */

    twMod2 = 2;
    twMod3 = 4;
    twMod4 = 6;

    /* TOP */
    p1ap3_0 = p1[0] + p3[0];
    p1sp3_0 = p1[0] - p3[0];
    p1ap3_1 = p1[1] + p3[1];
    p1sp3_1 = p1[1] - p3[1];

    /* col 2 */
    t2[0] = p1sp3_0 + p2[1] - p4[1];
    t2[1] = p1sp3_1 - p2[0] + p4[0];
    /* col 3 */
    t3[0] = p1ap3_0 - p2[0] - p4[0];
    t3[1] = p1ap3_1 - p2[1] - p4[1];
    /* col 4 */
    t4[0] = p1sp3_0 - p2[1] + p4[1];
    t4[1] = p1sp3_1 + p2[0] - p4[0];
    /* col 1 */
    *p1++ = p1ap3_0 + p2[0] + p4[0];
    *p1++ = p1ap3_1 + p2[1] + p4[1];

    /* Twiddle factors are ones */
    *p2++ = t2[0];
    *p2++ = t2[1];
    *p3++ = t3[0];
    *p3++ = t3[1];
    *p4++ = t4[0];
    *p4++ = t4[1];
	

	tw2 += twMod2;
	tw3 += twMod3;
	tw4 += twMod4;

    for (l = (L - 2) >> 1; l > 0; l-- )
    {
      /* TOP */
      p1ap3_0 = p1[0] + p3[0];
      p1sp3_0 = p1[0] - p3[0];
      p1ap3_1 = p1[1] + p3[1];
      p1sp3_1 = p1[1] - p3[1];
      /* col 2 */
      t2[0] = p1sp3_0 + p2[1] - p4[1];
      t2[1] = p1sp3_1 - p2[0] + p4[0];
      /* col 3 */
      t3[0] = p1ap3_0 - p2[0] - p4[0];
      t3[1] = p1ap3_1 - p2[1] - p4[1];
      /* col 4 */
      t4[0] = p1sp3_0 - p2[1] + p4[1];
      t4[1] = p1sp3_1 + p2[0] - p4[0];
      /* col 1 - top */
      *p1++ = p1ap3_0 + p2[0] + p4[0];
      *p1++ = p1ap3_1 + p2[1] + p4[1];

      /* BOTTOM */
      p1ap3_1 = pEnd1[-1] + pEnd3[-1];
      p1sp3_1 = pEnd1[-1] - pEnd3[-1];
      p1ap3_0 = pEnd1[ 0] + pEnd3[0];
      p1sp3_0 = pEnd1[ 0] - pEnd3[0];
      /* col 2 */
      t2[2] = pEnd2[0] - pEnd4[0] + p1sp3_1;
      t2[3] = pEnd1[0] - pEnd3[0] - pEnd2[-1] + pEnd4[-1];
      /* col 3 */
      t3[2] = p1ap3_1 - pEnd2[-1] - pEnd4[-1];
      t3[3] = p1ap3_0 - pEnd2[ 0] - pEnd4[ 0];
      /* col 4 */
      t4[2] = pEnd2[ 0] - pEnd4[ 0] - p1sp3_1;
      t4[3] = pEnd4[-1] - pEnd2[-1] - p1sp3_0;
      /* col 1 - Bottom */
      *pEnd1-- = p1ap3_0 + pEnd2[ 0] + pEnd4[ 0];
      *pEnd1-- = p1ap3_1 + pEnd2[-1] + pEnd4[-1];

      /* COL 2 */
      /* read twiddle factors */
	  twR = *tw2++;
      twI = *tw2++;


      /* multiply by twiddle factors */
      /*  let    Z1 = a + i(b),   Z2 = c + i(d) */
      /*   =>  Z1 * Z2  =  (a*c - b*d) + i(b*c + a*d) */

      /* Top */
      m0 = t2[0] * twR;
      m1 = t2[1] * twI;
      m2 = t2[1] * twR;
      m3 = t2[0] * twI;

      *p2++ = m0 + m1;
      *p2++ = m2 - m3;
      /* use vertical symmetry col 2 */
      /* 0.9997 - 0.0245i  <==>  0.0245 - 0.9997i */
      /* Bottom */
      m0 = t2[3] * twI;
      m1 = t2[2] * twR;
      m2 = t2[2] * twI;
      m3 = t2[3] * twR;

      *pEnd2-- = m0 - m1;
      *pEnd2-- = m2 + m3;

      /* COL 3 */
	  
      twR = tw3[0];
      twI = tw3[1];
      tw3 += twMod3;

      /* Top */
      m0 = t3[0] * twR;
      m1 = t3[1] * twI;
      m2 = t3[1] * twR;
      m3 = t3[0] * twI;

      *p3++ = m0 + m1;
      *p3++ = m2 - m3;
      /* use vertical symmetry col 3 */
      /* 0.9988 - 0.0491i  <==>  -0.9988 - 0.0491i */
      /* Bottom */
      m0 = -t3[3] * twR;
      m1 =  t3[2] * twI;
      m2 =  t3[2] * twR;
      m3 =  t3[3] * twI;

      *pEnd3-- = m0 - m1;
      *pEnd3-- = m3 - m2;

      /* COL 4 */
	  twR = tw4[0];
	  twI = tw4[1];
	  tw4 += twMod4;

      /* Top */
      m0 = t4[0] * twR;
      m1 = t4[1] * twI;
      m2 = t4[1] * twR;
      m3 = t4[0] * twI;

      *p4++ = m0 + m1;
      *p4++ = m2 - m3;
      /* use vertical symmetry col 4 */
      /* 0.9973 - 0.0736i  <==>  -0.0736 + 0.9973i */
      /* Bottom */
      m0 = t4[3] * twI;
      m1 = t4[2] * twR;
      m2 = t4[2] * twI;
      m3 = t4[3] * twR;

      *pEnd4-- = m0 - m1;
      *pEnd4-- = m2 + m3;
    }

    /* MIDDLE */
    /* Twiddle factors are */
    /*  1.0000  0.7071-0.7071i  -1.0000i  -0.7071-0.7071i */
    p1ap3_0 = p1[0] + p3[0];
    p1sp3_0 = p1[0] - p3[0];
    p1ap3_1 = p1[1] + p3[1];
    p1sp3_1 = p1[1] - p3[1];

    /* col 2 */
    t2[0] = p1sp3_0 + p2[1] - p4[1];
    t2[1] = p1sp3_1 - p2[0] + p4[0];
    /* col 3 */
    t3[0] = p1ap3_0 - p2[0] - p4[0];
    t3[1] = p1ap3_1 - p2[1] - p4[1];
    /* col 4 */
    t4[0] = p1sp3_0 - p2[1] + p4[1];
    t4[1] = p1sp3_1 + p2[0] - p4[0];
    /* col 1 - Top */
    *p1++ = p1ap3_0 + p2[0] + p4[0];
    *p1++ = p1ap3_1 + p2[1] + p4[1];

    /* COL 2 */
    twR = tw2[0];
    twI = tw2[1];

    m0 = t2[0] * twR;
    m1 = t2[1] * twI;
    m2 = t2[1] * twR;
    m3 = t2[0] * twI;

    *p2++ = m0 + m1;
    *p2++ = m2 - m3;
    /* COL 3 */

    twR = tw3[0];
    twI = tw3[1];

    m0 = t3[0] * twR;
    m1 = t3[1] * twI;
    m2 = t3[1] * twR;
    m3 = t3[0] * twI;

    *p3++ = m0 + m1;
    *p3++ = m2 - m3;
    /* COL 4 */
    twR = tw4[0];
	twI = tw4[1];

    m0 = t4[0] * twR;
    m1 = t4[1] * twI;
    m2 = t4[1] * twR;
    m3 = t4[0] * twI;

    *p4++ = m0 + m1;
    *p4++ = m2 - m3;

    /* first col */
    riscv_radix8_butterfly_f32 (pCol1, L, (float *) S->pTwiddle,(float *) S->pTwiddle2, 4U);

    /* second col */
    riscv_radix8_butterfly_f32 (pCol2, L, (float *) S->pTwiddle,(float *) S->pTwiddle2, 4U);

    /* third col */
    riscv_radix8_butterfly_f32 (pCol3, L, (float *) S->pTwiddle,(float *) S->pTwiddle2, 4U);

    /* fourth col */
    riscv_radix8_butterfly_f32 (pCol4, L, (float *) S->pTwiddle,(float *) S->pTwiddle2, 4U);
}


static void riscv_cfft_f32(
  const riscv_cfft_instance_f32 * S,
        float * p1,
        uint8_t ifftFlag,
        uint8_t bitReverseFlag)
{
  uint32_t  L = S->fftLen, l;
  float invL, * pSrc;

  if (ifftFlag == 1U)
  {
    /* Conjugate input data */
    pSrc = p1 + 1;
    for (l = 0; l < L; l++)
    {
      *pSrc = -*pSrc;
      pSrc += 2;
    }
  }
  if(S->fftLen == 512U)
  {
	  riscv_radix8_butterfly_f32 ( p1, L, (float *) S->pTwiddle,(float *) S->pTwiddle2, 1);
  }
  else if(S->fftLen == 256U)
  {
  	  riscv_cfft_radix8by4_f32 ( (riscv_cfft_instance_f32 *) S, p1);
  }

  if ( bitReverseFlag )
    riscv_bitreversal_32 ((uint32_t*) p1, S->bitRevLength, S->pBitRevTable);

  if (ifftFlag == 1U)
  {
    invL = 1.0f / (float)L;

    /* Conjugate and scale output data */
    pSrc = p1;
    for (l= 0; l < L; l++)
    {
      *pSrc++ *=   invL ;
      *pSrc    = -(*pSrc) * invL;
      pSrc++;
    }
  }
}

void riscv_rfft_fast_f32(
  riscv_rfft_fast_instance_f32 * S,
  float * p,
  float * pOut,
  uint8_t ifftFlag)
{
   riscv_cfft_instance_f32 * Sint = &(S->Sint);
   Sint->fftLen = S->fftLenRFFT / 2;

   /* Calculation of Real FFT */
   if (ifftFlag)
   {
      /*  Real FFT compression */
      merge_rfft_f32(S, p, pOut);

      /* Complex radix-4 IFFT process */
      riscv_cfft_f32( Sint, pOut, ifftFlag, 1);
   }
   else
   {
      /* Calculation of RFFT of input */
      riscv_cfft_f32( Sint, p, ifftFlag, 1);

      /*  Real FFT extraction */
      stage_rfft_f32(S, p, pOut);
   }
}

#define USE_MASK_ROM_FFT_DATA 1		  //ʹ��maskrom,����Ϊ1

int riscv_rfft_fast_init_f32( riscv_rfft_fast_instance_f32 * S,unsigned int fft_len ) {

  riscv_cfft_instance_f32 * Sint;

  if( !S ) return -1;

  Sint = &(S->Sint);
  Sint->fftLen = fft_len/2;
  S->fftLenRFFT = fft_len;

  switch (fft_len){
  	  case 512:
		  Sint->bitRevLength = RISCVBITREVINDEXTABLE_256_TABLE_LENGTH;
		  #if USE_MASK_ROM_FFT_DATA
	      Sint->pBitRevTable = (uint16_t *)MASK_ROM_FFT_BIT_ADDR;   //ԭmaskrom�еı�,��Ӧ����riscvBitRevIndexTable256;
		  #else
		  Sint->pBitRevTable = (uint16_t *)riscvBitRevIndexTable256;
		  #endif
		  break;
	  case 1024:
		  Sint->bitRevLength = RISCVBITREVINDEXTABLE_512_TABLE_LENGTH;
		  Sint->pBitRevTable = (uint16_t *)riscvBitRevIndexTable512; //1024fft�����ӵı�
		  Sint->pTwiddle2     = (float *) twiddleCoef_256_2;		 //1024fft�����ӵı�
          S->pTwiddleRFFT2    = (float *) twiddleCoef_rfft_512_2;	 //1024fft�����ӵı�
		  break;
  }
  
#if USE_MASK_ROM_FFT_DATA 
  Sint->pTwiddle     = (float *) MASK_ROM_FFT_COEF_ADDR;  //ԭmaskrom�еı�,��Ӧ����twiddleCoef_256;
  S->pTwiddleRFFT    = (float *) MASK_ROM_FFT_COEF_R_ADDR;//ԭmaskrom�еı�,��Ӧ����twiddleCoef_rfft_512;
#else  
  Sint->pTwiddle     = (float *) twiddleCoef_256;
  S->pTwiddleRFFT    = (float *) twiddleCoef_rfft_512;
#endif

  return 0;
}






